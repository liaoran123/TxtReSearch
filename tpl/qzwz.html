<!DOCTYPE html>
<html lang="zh">

<head>
	{{template "static" .}}
	<title>{{.Mc}}--{{jf "千佛网" .Ift}}</title>
</head>

<body>
	<div id="home" style="max-width: 1024px; margin-right: auto; margin-left: auto;">
		{{template "header" .}}
		{{template "search" .}}
		{{template "gomove" .}}
		<div class="card">
			<div class="card-header">				
					<h3>{{.Mc}}</h3>	
					<span id="text">{{.Jianjie}}</span>								
			</div>			
		</div>
		<div class="card" id="wzlist">
			<ul class="nav nav-tabs">
				<li class="nav-item">
				  <a id="qzwzdx" class="nav-link" aria-current="page" href="{{.Host}}/qzwz/{{.Id}}{{if .Ift}}?l=1{{end}}"><b>最新文章</b></a>
				</li>
				<li  class="nav-item">
				  <a   class="nav-link" href="/qzpl/{{.Id}}"><b>最新讨论</b></a>
				</li>  
				<li  class="nav-item">
					<a id="qzwzsx"  class="nav-link" href="{{.Host}}/qzwz/{{.Id}}?asc=1{{if .Ift}}&l=1{{end}}"><b>最早文章</b></a>
				  </li> 
				  <li class="nav-item">
					<a  class="nav-link" aria-current="page" href="#"><b>管理员</b></a>
				  </li>                  
			  </ul>  
			{{.WzHtml}}
		</div>
		<div class="card"><br>
		<nav aria-label="Page navigation example">
			<ul class="pagination">
				{{if ne .P ""}} 
                <li  class="page-item"><a  class="page-link" href="javascript:history.back();">{{jf "上一页" .Ift}}</a></li>
                {{end}}			
			  {{if eq .Pct 21}}
			  <li  class="page-item"><a class="page-link" href="{{.Host}}/qzwz/{{.Id}}-{{.Pn}}{{if .Ift}}?l=1{{end}}">{{jf "下一页" .Ift}}</a></li>
			  {{end}}			 
			</ul>
		  </nav>
		</div>
		<div class="alert alert-warning alert-dismissible fade show" role="alert" id="delqzdiv">
			<strong>{{jf "提示" .Ift}}</strong><br>
			{{jf "只有群组没有文章时可以删除。" .Ift}}<br>
			{{jf "如需要修改，可先删除，后添加。" .Ift}}<br>
			<div class="mb-3">
				<label for="exampleInputCaptcha" class="form-label"><b>{{jf "验证码" .Ift}}</b></label>
				<input type="text" class="form-control" id="codedel" maxlength="49" onfocus="getDelQzCaptcha()">
				<a href="javascript:" onclick="getDelQzCaptcha()"> <img src="" id="capimgdel"></a>
				<div id="mpanel2"></div>
				<button type="button" id="qz-btndel" data-id="123456" class="btn btn-primary" onclick="deleteqz()">{{jf
					"确定删除" .Ift}}</button>
			</div>
			<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
		</div>
		<div class="card">
			<div class="mb-3">
				<span class="badge bg-secondary">id</span><b class="badge bg-primary" id="qxuserid"></b> , <span
					class="badge bg-secondary">法号</span><b class="badge bg-primary" id="qzfahao"></b>
				<label for="exampleFormControlTextarea1" class="badge bg-primary fs-6">{{jf "发表文章" .Ift}}</label>
			</div>	
			<div class="mb-3">	
				<label for="exampleInputEmail1" class="form-label"><b>{{jf "标题" .Ift}}</b></label>
				<input type="text" class="form-control" id="title" maxlength="35">

			</div>	
			<div class="mb-3">
				<label for="exampleInputEmail1" class="form-label"><b>{{jf "内容" .Ift}}</b></label>
				<textarea class="form-control" id="cont" rows="7"></textarea>
			</div>
			<div class="mb-3">
				<label for="exampleInputCaptcha" class="form-label">{{jf "验证码" .Ift}}</label>
				<input type="text" class="form-control" id="code" maxlength="49" onfocus="getCaptcha()">
				<a href="javascript:" onclick="getCaptcha()"> <img src="" id="capimg"></a>
				<div id="mpanel2"></div>
				<button type="button" id="check-btn" data-id="" class="btn btn-primary" onclick="Ins()">{{jf
					"确定"
					.Ift}}</button>
			</div>
			<div class="alert alert-warning alert-dismissible fade show" role="alert">
				<strong>{{jf "言论规则、界限" .Ift}}</strong><br>
				{{jf "该板块仅限佛法或相关如法内容，其他言论请到其他平台发表。" .Ift}}
				<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
			</div>
		</div>
		{{template "footer" .}}
	</div>
	<script type="text/javascript">	
		$("#qxuserid").text($.cookie("id"))
		$("#qzfahao").text($.cookie("fahao"))
		divs= $("#wzlist div") 
		if ($(divs).length==0){//没有文章则显示可以删除
			$("#delqzdiv").show()
		} else {
			$("#delqzdiv").hide()
		}
		//设置活动页
		if (window.location.href.indexOf("?")==-1){
			$("#qzwzdx").addClass("active")
		}else{
			$("#qzwzsx").addClass("active")			
		}
		function getDelQzCaptcha() {
			btnobj = $("#qz-btndel")
			imgobj = $("#capimgdel")
			getCaptchaToObj(btnobj, imgobj)
		}
		function Ins() {
			fahao = $.cookie("fahao")
			if (fahao == "") {
				alert("请先登录！")
				return
			}
			userid = $.cookie("id")

			title=$("#title").val().trim()
			if (title == "") {
				alert("请输入标题。")
				return
			}
			cont=$("#cont").val().trim()
			if (cont == "") {
				alert("请输入内容。")
				return
			}
			code=$("#code").val();
			capid =$("#check-btn").attr("data-id")	
			if (code=="" || capid==""){
                alert("请输入验证码。")
                return
            }	
			
			$.post(jjsev+"/pubtb/",
				{	
					tbname: "wz",
					userid: userid,
					fahao: fahao,	
					type:"{{.Id}}"	,		
					typename:"{{.Mc}}",
					title:title,
					cont:cont,
					fahao: fahao,					
					code:code,
					capid: capid,
					method:"POST"				
				},
				function (result) {
					console.log(result)
					if (result.Succ == true) {
						alert(result.Info)
						window.location.href="/wz/"+result.LastId
					}else{
						alert(result.Info)
						$("#code").val("")	
					}
				}, "json");
		}

		function deleteqz() {			
			id = {{.Id}}
			if (id == "") { //用户操作错误。
				return
			}		
			fahao = $.cookie("fahao")
			if (fahao == "") {
				alert("请先登录！")
				return
			}
			
			capid = $("#qz-btndel").attr("data-id")
			code = $("#codedel").val()
			if (code == "" || capid == "") {
				alert("请输入验证码。")
				return
			}
			userid= $.cookie("id")
			$.post(jjsev + "/qz/",
				{
					id: id,
					userid: userid,
					code: code,
					capid: capid
				},
				function (result) {					
					if (result.Succ == true) {
						alert(result.Info)
						window.location.href="/user/home/"+ $.cookie("id")						
					} else {
						alert("系统错误！" + result.Info)
					}
					$("#code").val("")
				}, "json");
		}


	</script>

</body>

</html>